#!/usr/bin/env bash

set -e

if [[ $# -eq 0 ]]; then
  read -rp 'Enter file or directory name(s): ' INPUT
  read -r -a FILES <<< "$INPUT"
else
  FILES=("$@")
fi

if [[ ${#FILES[@]} -eq 0 ]]; then
  echo "Error: no input provided" >&2
  exit 1
fi

added=false

for FILE_NAME in "${FILES[@]}"; do
  for f in */.git/info/exclude; do
    if ! grep -qxF "$FILE_NAME" "$f"; then
      echo "$FILE_NAME" >> "$f"
      echo "Added '$FILE_NAME' to $f"
      added=true
    fi
  done
done

if ! $added; then
  echo "Nothing changed; all files were already present"
fi

# Hang

KEEP_OPEN=true

if [ "$KEEP_OPEN" = true ]; then
    echo
    read -p "Press 'Enter' to exit / Type 'disable' to disable hanging: " response
    if [ "$response" = "disable" ]; then
        sed -i 's/^KEEP_OPEN=true/KEEP_OPEN=false/' "$0"
        echo
        echo "KEEP_OPEN set to false"
        echo "Change 'KEEP_OPEN=true' to enable"
        sleep 4
    fi
fi
