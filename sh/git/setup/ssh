#!/usr/bin/env bash

set -e

# Ask user for install directory, default to current directory
read -rp "Enter install directory (leave blank for current directory): " DEST_DIR
DEST_DIR="${DEST_DIR:-$(pwd)}"

# Ask user if they want to hide the files
read -rp "Hide SSH Scripts? (y/N): " HIDE_FILES
HIDE_FILES="${HIDE_FILES:-N}"

# Create temporary directory
TMP_DIR=$(mktemp -d)

# Clone the repository into the temporary directory
git clone --depth 1 https://github.com/NikoboiNFTB/GitHub-Tools.git "$TMP_DIR"

# Copy all files from /shell/git/ssh/ into the install directory
SRC_DIR="$TMP_DIR/shell/git/ssh"
if [ -d "$SRC_DIR" ]; then
    for FILE in "$SRC_DIR"/*; do
        BASENAME=$(basename "$FILE")
        TARGET="$DEST_DIR/$BASENAME"
        # If hiding, prefix with dot
        if [[ "$HIDE_FILES" =~ ^[Yy]$ ]]; then
            TARGET="$DEST_DIR/.$BASENAME"
        fi
        cp -r "$FILE" "$TARGET"
    done
    echo "Files copied to $DEST_DIR"
else
    echo "Error: $SRC_DIR does not exist in the repository"
fi

# Clean up temporary directory
rm -rf "$TMP_DIR"

# Hang

KEEP_OPEN=true

if [ "$KEEP_OPEN" = true ]; then
    echo
    read -p "Press 'Enter' to exit / Type 'disable' to disable hanging: " response
    if [ "$response" = "disable" ]; then
        sed -i 's/^KEEP_OPEN=true/KEEP_OPEN=false/' "$0"
        echo
        echo "KEEP_OPEN set to false"
        echo "Change 'KEEP_OPEN=true' to enable"
        sleep 4
    fi
fi
