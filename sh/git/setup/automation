#!/usr/bin/env bash

set -e

# Ask user for install directory for regular files (Enter for current)
read -rp "Enter install directory for regular files (Enter for current): " BASE_DIR
BASE_DIR="${BASE_DIR:-$(pwd)}"

# Determine parent directory for clone files
PARENT_DIR="$(dirname "$BASE_DIR")"

# Temporary clone
TMP_DIR=$(mktemp -d)
REPO_URL="https://github.com/NikoboiNFTB/GitHub-Tools.git"
git clone --depth 1 "$REPO_URL" "$TMP_DIR"

# Function to copy everything (files and directories) from source to destination
copy_all() {
    local SRC="$1"
    local DEST="$2"
    if [ -d "$SRC" ]; then
        for ITEM in "$SRC"/*; do
            [ -e "$ITEM" ] || continue
            BASENAME=$(basename "$ITEM")
            if [ -d "$ITEM" ]; then
                mkdir -p "$DEST/$BASENAME"
                cp -r "$ITEM/." "$DEST/$BASENAME"
            else
                mkdir -p "$DEST"
                cp "$ITEM" "$DEST/$BASENAME"
            fi
            echo "Copied $ITEM -> $DEST/$BASENAME"
        done
    else
        echo "Warning: $SRC not found"
    fi
}

# Copy bulk, repo, and ssh files into current directory (BASE_DIR)
copy_all "$TMP_DIR/shell/git/bulk" "$BASE_DIR"
copy_all "$TMP_DIR/shell/git/repo" "$BASE_DIR"

# Copy clone files into parent directory
copy_all "$TMP_DIR/shell/git/clone" "$PARENT_DIR"

# Clean up temporary clone
rm -rf "$TMP_DIR"

echo "Automation setup complete."

# Hang

KEEP_OPEN=true

if [ "$KEEP_OPEN" = true ]; then
    echo
    read -p "Press 'Enter' to exit / Type 'disable' to disable hanging: " response
    if [ "$response" = "disable" ]; then
        sed -i 's/^KEEP_OPEN=true/KEEP_OPEN=false/' "$0"
        echo
        echo "KEEP_OPEN set to false"
        echo "Change 'KEEP_OPEN=true' to enable"
        sleep 4
    fi
fi
